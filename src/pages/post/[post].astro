---
import { ArrowLeft, Calendar, Clock } from "@lucide/astro";
import Layout from "../../layouts/Layout.astro";
import Avatar from "../../components/ui/Avatar.astro";
import Badge from "../../components/ui/Badge.astro";
import { getPosts, type Post } from "../../lib/hashnode";

export async function getStaticPaths() {
  const { posts } = await getPosts();

  return posts.map((post: Post) => ({
    params: { post: post.slug },
    props: { post },
  }));
}

interface Props {
  post: Post;
}

const { post } = Astro.props;

const formatDate = (dateString: string) => {
  return new Date(dateString).toLocaleDateString("es-ES", {
    day: "2-digit",
    month: "2-digit",
    year: "numeric",
  });
};
---

<Layout>
  <div class="max-w-4xl mx-auto py-10 space-y-8">
    <div>
      <div>
        <a href="/" class="inline-block">
          <button
            class="flex items-center gap-3 text-gray-500 hover:text-white transition-colors group text-sm font-medium cursor-pointer"
          >
            <div
              class="w-8 h-8 rounded-full bg-white/5 border border-white/10 flex items-center justify-center group-hover:bg-white/10 transition-colors"
            >
              <ArrowLeft size={14} />
            </div>
            Regresar al blog
          </button></a
        >
      </div>
    </div>
    <article class="px-4 space-y-6">
      {
        post.tags && post.tags.length > 0 ? (
          <Badge
            text={post.tags[0].name}
            class="inline-block"
            variant="outline"
            color="primary"
          />
        ) : (
          <Badge
            text="General"
            class="inline-block"
            variant="outline"
            color="primary"
          />
        )
      }
      <h1 class="text-4xl md:text-6xl font-bold text-white tracking-tight">
        {post.title}
      </h1>
      <div class="flex items-center gap-4 border-b border-white/5 pb-8 mb-8">
        <div class="flex items-center gap-2">
          <Avatar
            size="sm"
            src={post.author.profilePicture}
            alt={post.author.name}
          />
          <span class="text-sm">{post.author.name}</span>
        </div>
        <div class="hidden md:block w-px h-8 bg-white/5"></div>
        <div class="flex items-center gap-4 text-gray-500 text-xs">
          <div class="flex items-center gap-2">
            <Calendar size={14} />
            <span>{formatDate(post.publishedAt)}</span>
          </div>
          <div class="flex items-center gap-2">
            <Clock size={14} />
            <span>{post.readTimeInMinutes} min</span>
          </div>
        </div>
      </div>
      <img
        src={post.coverImage.url}
        alt={post.title}
        class="w-full h-96 object-cover rounded-lg"
      />
      <div
        class="mt-8 prose prose-invert max-w-none"
        set:html={post.content.html}
      />
    </article>
  </div>
</Layout>
